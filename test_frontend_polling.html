<!DOCTYPE html>
<html>
<head>
    <title>Test Notification Polling</title>
</head>
<body>
    <h1>Test Notification Polling</h1>
    <div id="status">Checking...</div>
    <div id="notifications"></div>
    <div id="time"></div>
    
    <script>
        const API_BASE = 'http://127.0.0.1:8000';
        
        function updateTime() {
            document.getElementById('time').textContent = 'Current time: ' + new Date().toLocaleTimeString();
        }
        
        async function checkNotifications() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const response = await fetch(`${API_BASE}/notifications?day=${today}`);
                
                if (response.ok) {
                    const notifications = await response.json();
                    document.getElementById('status').textContent = `Found ${notifications.length} notifications`;
                    
                    let html = '<h3>Notifications:</h3>';
                    notifications.forEach(notif => {
                        const scheduledTime = new Date(notif.scheduled_time);
                        const now = new Date();
                        const timeDiff = (scheduledTime - now) / (1000 * 60); // minutes
                        
                        html += `<div style="border: 1px solid #ccc; margin: 5px; padding: 10px;">`;
                        html += `<strong>${notif.drug_name}</strong><br>`;
                        html += `Scheduled: ${scheduledTime.toLocaleString()}<br>`;
                        html += `Time diff: ${timeDiff.toFixed(1)} minutes<br>`;
                        html += `Should show: ${timeDiff <= 0 ? 'YES' : 'NO'}`;
                        html += `</div>`;
                    });
                    document.getElementById('notifications').innerHTML = html;
                } else {
                    document.getElementById('status').textContent = 'Error: ' + response.status;
                }
            } catch (error) {
                document.getElementById('status').textContent = 'Error: ' + error.message;
            }
        }
        
        // Update time every second
        setInterval(updateTime, 1000);
        updateTime();
        
        // Check notifications every 5 seconds
        setInterval(checkNotifications, 5000);
        checkNotifications();
    </script>
</body>
</html>
